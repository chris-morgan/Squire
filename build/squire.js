var Squire=function(){"use strict";function e(e,t){for(var n=e.length;n--;)if(!t(e[n]))return!1;return!0}function t(){nt=Ye?new WeakMap:null}function n(e){return e.nodeType===Ce&&!!ot[e.nodeName]}function r(t){switch(t.nodeType){case _e:return at;case Ce:case Se:if(Ye&&nt.has(t))return nt.get(t);break;default:return it}var n;return n=e(t.childNodes,o)?rt.test(t.nodeName)?at:st:dt,Ye&&nt.set(t,n),n}function o(e){return r(e)===at}function i(e){return r(e)===st}function a(e){return r(e)===dt}function s(e,t){var n=new tt(t,Te,i);return n.currentNode=e,n}function d(e,t){return e=s(e,t).previousNode(),e!==t?e:null}function l(e,t){return e=s(e,t).nextNode(),e!==t?e:null}function c(e,t){return!n(e)&&e.nodeType===t.nodeType&&e.nodeName===t.nodeName&&"A"!==e.nodeName&&e.className===t.className&&(!e.style&&!t.style||e.style.cssText===t.style.cssText)}function u(e,t,n){if(e.nodeName!==t)return!1;for(var r in n)if(e.getAttribute(r)!==n[r])return!1;return!0}function f(e,t,n,r){for(;e&&e!==t;){if(u(e,n,r))return e;e=e.parentNode}return null}function h(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function p(e,t){var n="";if(e&&e!==t&&(n=p(e.parentNode,t),e.nodeType===Ce)){n+=(n?">":"")+e.nodeName;var r=e.id;r&&(n+="#"+r);var o,i=e.className.trim();i&&(o=i.split(/\s\s*/),o.sort(),n+=".",n+=o.join("."));var a=e.dir;a&&(n+="[dir="+a+"]"),o&&(o.indexOf(Ae)>-1&&(n+="[backgroundColor="+e.style.backgroundColor.replace(/ /g,"")+"]"),o.indexOf(Be)>-1&&(n+="[color="+e.style.color.replace(/ /g,"")+"]"),o.indexOf(Oe)>-1&&(n+="[fontFamily="+e.style.fontFamily.replace(/ /g,"")+"]"),o.indexOf(De)>-1&&(n+="[fontSize="+e.style.fontSize+"]"))}return n}function v(e){return e.nodeType===Ce?e.childNodes.length:e.length||0}function g(e){var t=e.parentNode;return t&&t.removeChild(e),e}function m(e,t){var n=e.parentNode;n&&n.replaceChild(t,e)}function N(e){for(var t=e.ownerDocument.createDocumentFragment(),n=e.childNodes,r=n?n.length:0;r--;)t.appendChild(e.firstChild);return t}function C(e,t,n,r){var o=e.createElement(t);if(n instanceof Array&&(r=n,n=null),n)for(var i in n){var a=n[i];void 0!==a&&o.setAttribute(i,n[i])}if(r)for(var s=0,d=r.length;s<d;s+=1)o.appendChild(r[s]);return o}function _(e,t){var r,i,a=t.__squire__,s=e.ownerDocument,d=e;if(e===t&&((i=e.firstChild)&&"BR"!==i.nodeName||(r=a.createDefaultBlock(),i?e.replaceChild(r,i):e.appendChild(r),e=r,r=null)),e.nodeType===_e)return d;if(o(e)){for(i=e.firstChild;Qe&&i&&i.nodeType===_e&&!i.data;)e.removeChild(i),i=e.firstChild;i||(Qe?(r=s.createTextNode(Re),a._didAddZWS()):r=s.createTextNode(""))}else if(je){for(;e.nodeType!==_e&&!n(e);){if(i=e.firstChild,!i){r=s.createTextNode("");break}e=i}e.nodeType===_e?/^ +$/.test(e.data)&&(e.data=""):n(e)&&e.parentNode.insertBefore(s.createTextNode(""),e)}else if(!e.querySelector("BR"))for(r=C(s,"BR");(i=e.lastElementChild)&&!o(i);)e=i;if(r)try{e.appendChild(r)}catch(t){a.didError({name:"Squire: fixCursor – "+t,message:"Parent: "+e.nodeName+"/"+e.innerHTML+" appendChild: "+r.nodeName})}return d}function y(e,t){for(var n=e.childNodes,r=e.ownerDocument,i=null,s=t.__squire__._config,d=0,l=n.length;d<l;d+=1){var c=n[d],u="BR"===c.nodeName;!u&&o(c)?(i||(i=C(r,s.blockTag,s.blockAttributes)),i.appendChild(c),d-=1,l-=1):(u||i)&&(i||(i=C(r,s.blockTag,s.blockAttributes)),_(i,t),u?e.replaceChild(i,c):(e.insertBefore(i,c),d+=1,l+=1),i=null),a(c)&&y(c,t)}return i&&e.appendChild(_(i,t)),e}function S(e,t,n,r){var o=e.nodeType;if(o===_e&&e!==n)return S(e.parentNode,e.splitText(t),n,r);if(o===Ce){if("number"==typeof t&&(t=t<e.childNodes.length?e.childNodes[t]:null),e===n)return t;for(var i,a=e.parentNode,s=e.cloneNode(!1);t;)i=t.nextSibling,s.appendChild(t),t=i;return"OL"===e.nodeName&&f(e,r,"BLOCKQUOTE")&&(s.start=(+e.start||1)+e.childNodes.length-1),_(e,r),_(s,r),(i=e.nextSibling)?a.insertBefore(s,i):a.appendChild(s),S(a,s,n,r)}return t}function T(e,t){for(var n=e.childNodes,r=n.length,i=[];r--;){var a=n[r],s=r&&n[r-1];if(r&&o(a)&&c(a,s)&&!ot[a.nodeName])t.startContainer===a&&(t.startContainer=s,t.startOffset+=v(s)),t.endContainer===a&&(t.endContainer=s,t.endOffset+=v(s)),t.startContainer===e&&(t.startOffset>r?t.startOffset-=1:t.startOffset===r&&(t.startContainer=s,t.startOffset=v(s))),t.endContainer===e&&(t.endOffset>r?t.endOffset-=1:t.endOffset===r&&(t.endContainer=s,t.endOffset=v(s))),g(a),a.nodeType===_e?s.appendData(a.data):i.push(N(a));else if(a.nodeType===Ce){for(var d=i.length;d--;)a.appendChild(i.pop());T(a,t)}}}function b(e,t){if(e.nodeType===_e&&(e=e.parentNode),e.nodeType===Ce){var n=t.startContainer,r=t.startOffset,o=t.endContainer,i=t.endOffset;T(e,{startContainer:n,startOffset:r,endContainer:o,endOffset:i}),t.setStart(n,r),t.setEnd(o,i)}}function E(e,t,n){for(var r=t;1===r.parentNode.childNodes.length;)r=r.parentNode;g(r);var o=e.childNodes.length,i=e.lastChild;i&&"BR"===i.nodeName&&(e.removeChild(i),o-=1),e.appendChild(N(t)),n.setStart(e,o),n.collapse(!0),b(e,n),ze&&(i=e.lastChild)&&"BR"===i.nodeName&&e.removeChild(i)}function k(e,t){var n=e.previousSibling,r=e.firstChild,o=e.ownerDocument,i="LI"===e.nodeName;if(!i||r&&/^[OU]L$/.test(r.nodeName))if(n&&c(n,e)){if(!a(n)){if(!i)return;var s=C(o,"DIV");s.appendChild(N(n)),n.appendChild(s)}g(e);var d=!a(e);n.appendChild(N(e)),d&&y(n,t),r&&k(r,t)}else i&&(n=C(o,"DIV"),e.insertBefore(n,r),_(n,t))}function L(e,t){for(var n=e.childNodes;t&&e.nodeType===Ce;)e=n[t-1],n=e.childNodes,t=n.length;return e}function x(e,t){if(e.nodeType===Ce){var n=e.childNodes;if(t<n.length)e=n[t];else{for(;e&&!e.nextSibling;)e=e.parentNode;e&&(e=e.nextSibling)}}return e}function A(e,t){var n,r=e.startContainer,o=e.startOffset,i=e.endContainer,a=e.endOffset;if(r.nodeType===_e){var s=r.parentNode;if(n=s.childNodes,o===r.length)o=Je.call(n,r)+1,e.collapsed&&(i=s,a=o);else{if(o){var d=r.splitText(o);i===r?(a-=o,i=d):i===s&&(a+=1),r=d}o=Je.call(n,r)}r=s}else n=r.childNodes;var l=n.length;o===l?r.appendChild(t):r.insertBefore(t,n[o]),r===i&&(a+=n.length-l),e.setStart(r,o),e.setEnd(i,a)}function B(e,t,n){var r=e.startContainer,o=e.startOffset,i=e.endContainer,a=e.endOffset;t||(t=e.commonAncestorContainer),t.nodeType===_e&&(t=t.parentNode);for(var s=S(i,a,t,n),d=S(r,o,t,n),l=t.ownerDocument.createDocumentFragment();d!==s;){var c=d.nextSibling;l.appendChild(d),d=c}r=t,o=s?Je.call(t.childNodes,s):t.childNodes.length;var u=t.childNodes[o],f=u&&u.previousSibling;return f&&f.nodeType===_e&&u.nodeType===_e&&(r=f,o=f.length,f.appendData(u.data),g(u)),e.setStart(r,o),e.collapse(!0),_(t,n),l}function O(e,t){var n=I(e,t),r=w(e,t),o=n!==r;U(e),P(e,n,r,t);var i=B(e,null,t);U(e),o&&(r=w(e,t),n&&r&&n!==r&&E(n,r,e)),n&&_(n,t);var a=t.firstChild;return a&&"BR"!==a.nodeName?e.collapse(!0):(_(t,t),e.selectNodeContents(t.firstChild)),i}function D(e,t,n){for(var r=!0,s=t.childNodes,c=s.length;c--;)if(!o(s[c])){r=!1;break}if(e.collapsed||O(e,n),U(e),r)A(e,t),e.startContainer!==e.endContainer&&b(e.endContainer,e),b(e.startContainer,e),e.collapse(!1);else{for(var u,h=e.startContainer,p=S(h,e.startOffset,f(h.parentNode,n,"BLOCKQUOTE")||n,n),v=p.previousSibling,g=v,m=g.childNodes.length,N=p,C=0,y=p.parentNode;(u=g.lastChild)&&u.nodeType===Ce;){if("BR"===u.nodeName){m-=1;break}g=u,m=g.childNodes.length}for(;(u=N.firstChild)&&u.nodeType===Ce&&"BR"!==u.nodeName;)N=u;for(var T=g.childNodes[m]||null;(u=t.firstChild)&&o(u);)g.insertBefore(u,T);for(;(u=t.lastChild)&&o(u);)N.insertBefore(u,N.firstChild),C+=1;for(var E=t;E=l(E,n);)_(E,n);y.insertBefore(t,p);var L=v.nextSibling;if(E=d(L,n),E&&!/\S/.test(E.textContent))do y=E.parentNode,y.removeChild(E),E=y;while(E&&!E.lastChild&&E!==n);v.parentNode||(v=L.previousSibling),g.parentNode||(g=v||L.parentNode,m=v?v.childNodes.length:0),a(L)&&k(L,n);var x=p.previousSibling;if(E=i(p)?p:l(p,n),E&&!/\S/.test(E.textContent))do y=E.parentNode,y.removeChild(E),E=y;while(E&&!E.lastChild&&E!==n);p.parentNode||(p=x.nextSibling),C||(N=x,C=x.childNodes.length),p&&a(p)&&k(p,n),e.setStart(g,m),e.setEnd(N,C),U(e)}}function R(e,t,n){var r=t.ownerDocument.createRange();if(r.selectNode(t),n){var o=e.compareBoundaryPoints(xe,r)>-1,i=e.compareBoundaryPoints(ke,r)<1;return!o&&!i}var a=e.compareBoundaryPoints(Ee,r)<1,s=e.compareBoundaryPoints(Le,r)>-1;return a&&s}function U(e){for(var t,r=e.startContainer,o=e.startOffset,i=e.endContainer,a=e.endOffset,s=!0;r.nodeType!==_e&&(t=r.childNodes[o],t&&!n(t));)r=t,o=0;if(a)for(;i.nodeType!==_e;){if(t=i.childNodes[a-1],!t||n(t)){if(s&&t&&"BR"===t.nodeName){a-=1,s=!1;continue}break}i=t,a=v(i)}else for(;i.nodeType!==_e&&(t=i.firstChild,t&&!n(t));)i=t;e.collapsed?(e.setStart(i,a),e.setEnd(r,o)):(e.setStart(r,o),e.setEnd(i,a))}function P(e,t,n,r){var o,i=e.startContainer,a=e.startOffset,s=e.endContainer,d=e.endOffset,l=!0;for(t||(t=e.commonAncestorContainer),n||(n=t);!a&&i!==t&&i!==r;)o=i.parentNode,a=Je.call(o.childNodes,i),i=o;for(;l&&s.nodeType!==_e&&s.childNodes[d]&&"BR"===s.childNodes[d].nodeName&&(d+=1,l=!1),s!==n&&s!==r&&d===v(s);)o=s.parentNode,d=Je.call(o.childNodes,s)+1,s=o;e.setStart(i,a),e.setEnd(s,d)}function I(e,t){var n,r=e.startContainer;return o(r)?n=d(r,t):r!==t&&i(r)?n=r:(n=L(r,e.startOffset),n=l(n,t)),n&&R(e,n,!0)?n:null}function w(e,t){var n,r=e.endContainer;if(o(r))n=d(r,t);else if(r!==t&&i(r))n=r;else{if(n=x(r,e.endOffset),!n||!h(t,n)){n=t;for(var a;a=n.lastChild;)n=a}n=d(n,t)}return n&&R(e,n,!0)?n:null}function F(e,t){var n,r=e.startContainer,o=e.startOffset;if(lt.root=null,r.nodeType===_e){if(o)return!1;n=r}else if(n=x(r,o),n&&!h(t,n)&&(n=null),!n&&(n=L(r,o),n.nodeType===_e&&n.length))return!1;return lt.currentNode=n,lt.root=I(e,t),!lt.previousNode()}function M(e,t){var n=e.endContainer,r=e.endOffset;if(lt.root=null,n.nodeType===_e){var o=n.data.length;if(o&&r<o)return!1;lt.currentNode=n}else lt.currentNode=L(n,r);return lt.root=w(e,t),!lt.nextNode()}function H(e,t){var n=I(e,t),r=w(e,t);if(n&&r){var o=n.parentNode;e.setStart(o,Je.call(o.childNodes,n)),o=r.parentNode,e.setEnd(o,Je.call(o.childNodes,r)+1)}}function W(e){return function(t,n){var r=C(t.ownerDocument,e);return n.replaceChild(r,t),r.appendChild(N(t)),r}}function z(e,t){var n,r,o=e.style,i=e.ownerDocument;for(var a in ut){var s=ut[a],d=o[a];if(d&&s.regexp.test(d)){var l=s.replace(i,d);r||(r=l),n&&n.appendChild(l),n=l,e.style[a]=""}}return r&&(n.appendChild(N(e)),"SPAN"===e.nodeName?t.replaceChild(r,e):e.appendChild(r)),n||e}function q(e,t){for(var n=e;o(n);)n=n.parentNode;vt.root=n;for(var r=e.childNodes,i=0,a=r.length;i<a;i+=1){var s=r[i],d=s.nodeName,l=s.nodeType,c=ft[d];if(l===Ce){var u=s.childNodes.length;if(c)s=c(s,e);else{if(pt.test(d)){e.removeChild(s),i-=1,a-=1;continue}if(!ht.test(d)&&!o(s)){i-=1,a+=u-1,e.replaceChild(N(s),s);continue}}u&&q(s,t||"PRE"===d)}else{if(l===_e){var f=s.data,h=void 0,p=!Xe.test(f.charAt(0)),v=!Xe.test(f.charAt(f.length-1));if(t||!p&&!v)continue;if(p){for(vt.currentNode=s;(h=vt.previousPONode())&&(d=h.nodeName,!("IMG"===d||"#text"===d&&Xe.test(h.data)));)if(!o(h)){h=null;break}f=f.replace(/^[ \t\r\n]+/g,h?" ":"")}if(v){for(vt.currentNode=s;(h=vt.nextNode())&&!("IMG"===d||"#text"===d&&Xe.test(h.data));)if(!o(h)){h=null;break}f=f.replace(/[ \t\r\n]+$/g,h?" ":"")}if(f){s.data=f;continue}}e.removeChild(s),i-=1,a-=1}}return e}function K(e){for(var t=e.childNodes,r=t.length;r--;){var i=t[r];i.nodeType!==Ce||n(i)?i.nodeType!==_e||i.data||e.removeChild(i):(K(i),o(i)&&!i.firstChild&&e.removeChild(i))}}function G(e){return e.nodeType===Ce?"BR"===e.nodeName:Xe.test(e.data)}function Z(e,t){for(var n=e.parentNode;o(n);)n=n.parentNode;var r=new tt(n,Te|be,G);return r.currentNode=e,!!r.nextNode()||t&&!r.previousNode()}function j(e,t,n){for(var r=e.querySelectorAll("BR"),i=[],a=r.length,s=0;s<a;s+=1)i[s]=Z(r[s],n);for(;a--;){var d=r[a],l=d.parentNode;l&&(i[a]?o(l)||y(l,t):g(d))}}function Q(e,t,n){var r=t.ownerDocument.body;j(t,n,!0),t.setAttribute("style","position:fixed;overflow:hidden;bottom:100%;right:100%;"),r.appendChild(t);var o=t.innerHTML,i=t.innerText||t.textContent;Me&&(i=i.replace(/\r?\n/g,"\r\n")),e.setData("text/html",o),e.setData("text/plain",i),r.removeChild(t)}function V(e){var t=e.clipboardData,n=this.getSelection(),r=this._root,o=this;if(n.collapsed)return void e.preventDefault();if(this.saveUndoState(n),qe||we||!t)setTimeout(function(){try{o._ensureBottomLine()}catch(e){o.didError(e)}},0);else{var i=I(n,r),a=w(n,r),s=i===a&&i||r,d=O(n,r),l=n.commonAncestorContainer;for(l.nodeType===_e&&(l=l.parentNode);l&&l!==s;){var c=l.cloneNode(!1);c.appendChild(d),d=c,l=l.parentNode}var u=this.createElement("div");u.appendChild(d),Q(t,u,r),e.preventDefault()}this.setSelection(n)}function $(e){var t=e.clipboardData,n=this.getSelection(),r=this._root;if(!qe&&!we&&t){var o=I(n,r),i=w(n,r),a=o===i&&o||r;n=n.cloneRange(),U(n),P(n,a,a,r);var s=n.cloneContents(),d=n.commonAncestorContainer;for(d.nodeType===_e&&(d=d.parentNode);d&&d!==a;){var l=d.cloneNode(!1);l.appendChild(s),s=l,d=d.parentNode}var c=this.createElement("div");c.appendChild(s),Q(t,c,r),e.preventDefault()}}function Y(e){this.isShiftDown=e.shiftKey}function X(e){var t=e.clipboardData,n=t&&t.items,r=this.isShiftDown,o=this;if(qe||!n){var i=t&&t.types;if(!qe&&i&&(Je.call(i,"text/html")>-1||!He&&Je.call(i,"text/plain")>-1&&Je.call(i,"text/rtf")<0)){e.preventDefault();var a=t.getData("text/html");return void(!r&&a?this.insertHTML(a,!0):((a=t.getData("text/plain"))||(a=t.getData("text/uri-list")))&&this.insertPlainText(a,!0))}this._awaitingPaste=!0;var s=this._doc.body,d=this.getSelection(),l=d.startContainer,c=d.startOffset,u=d.endContainer,f=d.endOffset,h=this.createElement("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});s.appendChild(h),d.selectNodeContents(h),this.setSelection(d),setTimeout(function(){try{o._awaitingPaste=!1;for(var e="",t=h;h=t;){t=h.nextSibling,g(h);var n=h.firstChild;n&&n===h.lastChild&&"DIV"===n.nodeName&&(h=n),e+=h.innerHTML}o.setSelection(o._createRange(l,c,u,f)),e&&o.insertHTML(e,!0)}catch(e){o.didError(e)}},0)}else{var p=!1,v=null;e.preventDefault();for(var m=n.length;m--;){var N=n[m],C=N.type;if(!r&&"text/html"===C)return void N.getAsString(function(e){return o.insertHTML(e,!0)});"text/plain"===C&&(v=N),!r&&/^image\/.*/.test(C)&&(p=!0)}if(p){var _=!1;this.fireEvent("dragover",{dataTransfer:t,preventDefault:function(){_=!0}}),_&&this.fireEvent("drop",{dataTransfer:t})}else v&&v.getAsString(function(e){return o.insertPlainText(e,!0)})}}function J(e){for(var t=e.dataTransfer.types,n=t.length,r=!1,o=!1;n--;)switch(t[n]){case"text/plain":r=!0;break;case"text/html":o=!0;break;default:return}(o||r)&&this.saveUndoState()}function ee(e){if(!e.defaultPrevented){var t=e.keyCode,n=gt[t],r=this.getSelection();n||(n=String.fromCharCode(t).toLowerCase(),/^[A-Za-z0-9]$/.test(n)||(n="")),ze&&46===e.which&&(n="."),111<t&&t<124&&(n="f"+(t-111));var o="";"backspace"!==n&&"delete"!==n&&(e.altKey&&(o+="alt-"),e.ctrlKey&&(o+="ctrl-"),e.metaKey&&(o+="meta-")),e.shiftKey&&(o+="shift-"),n=o+n,this._keyHandlers[n]?this._keyHandlers[n](this,e,r):1!==n.length||r.collapsed||(this.saveUndoState(r),O(r,this._root),this._ensureBottomLine(),this.setSelection(r),this._updatePath(r,!0))}}function te(e){return function(t,n){n.preventDefault(),t[e]()}}function ne(e,t){return t=t||null,function(n,r){r.preventDefault();var o=n.getSelection();n.hasFormat(e,null,o)?n.changeFormat(null,{tag:e},o):n.changeFormat({tag:e},t,o)}}function re(e,t){try{t||(t=e.getSelection());var n=t.startContainer;n.nodeType===_e&&(n=n.parentNode);for(var r=n;o(r)&&(!r.textContent||r.textContent===Re);)n=r,r=n.parentNode;n!==r&&(t.setStart(r,Je.call(r.childNodes,n)),t.collapse(!0),r.removeChild(n),i(r)||(r=d(r,e._root)),_(r,e._root),U(t)),n===e._root&&(n=n.firstChild)&&"BR"===n.nodeName&&g(n),e._ensureBottomLine(),e.setSelection(t),e._updatePath(t,!0)}catch(t){e.didError(t)}}function oe(e,t,n){if(e||(e={}),t)for(var r in t)if(n||!(r in e)){var o=t[r];e[r]=o&&o.constructor===Object?oe(e[r],o,n):o}return e}function ie(e,t,n){var r=n._doc,o=e?DOMPurify.sanitize(e,{WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0}):null;return o?r.importNode(o,!0):r.createDocumentFragment()}function ae(e){return e._win.getSelection()||null}function se(){this._restoreSelection=!0}function de(){this._restoreSelection=!1}function le(){this._restoreSelection&&this.setSelection(this._lastSelection)}function ce(e,t){for(var n,r,i=new tt(e,be,function(){return!0},!1);n=i.nextNode();)for(;(r=n.data.indexOf(Re))>-1&&(!t||n.parentNode!==t);){if(1===n.length){do{var a=n.parentNode;a.removeChild(n),n=a,i.currentNode=a}while(o(n)&&!v(n));break}n.deleteData(r,1)}}function ue(e,t,n,r){var o=Ct[t.nodeName],i=null,a=S(n,r,t.parentNode,e._root),s=e._config;return o||(o=s.blockTag,i=s.blockAttributes),u(a,o,i)||(t=C(a.ownerDocument,o,i),a.dir&&(t.dir=a.dir),m(a,t),t.appendChild(N(a)),a=t),a}function fe(){return this.createDefaultBlock([this.createElement("INPUT",{id:_t,type:"hidden"}),this.createElement("INPUT",{id:yt,type:"hidden"})])}function he(e,t,n){for(var r,o=s(t,e._root),i=e._config.tagAttributes,a=i[n.toLowerCase()],d=i.li;r=o.nextNode();)if("LI"===r.parentNode.nodeName&&(r=r.parentNode,o.currentNode=r.lastChild),"LI"!==r.nodeName){var l=e.createElement("LI",d);r.dir&&(l.dir=r.dir);var c=r.previousSibling;c&&c.nodeName===n?(c.appendChild(l),g(r)):m(r,e.createElement(n,a,[l])),l.appendChild(N(r)),o.currentNode=l}else{r=r.parentNode;var u=r.nodeName;u!==n&&/^[OU]L$/.test(u)&&m(r,e.createElement(n,a,[N(r)]))}}function pe(e,t,n){for(var r,o,i=e.ownerDocument,a=new tt(e,be,function(e){return!f(e,t,"A")},!1),s=n._config.tagAttributes.a;r=a.nextNode();)for(var d=r.data,l=r.parentNode;o=St.exec(d);){var c=o.index,u=c+o[0].length;if(c){var h=i.createTextNode(d.slice(0,c));l.insertBefore(h,r)}var p=n.createElement("A",oe({href:o[1]?/^(?:ht|f)tps?:/.test(o[1])?o[1]:"http://"+o[1]:"mailto:"+o[2]},s,!1));p.textContent=d.slice(c,u),l.insertBefore(p,r),r.data=d=d.slice(u)}}function ve(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function ge(e,t,n){for(var r=t.firstChild,a=void 0;r;r=a){if(a=r.nextSibling,o(r)){if(r.nodeType===_e||"BR"===r.nodeName||"IMG"===r.nodeName){n.appendChild(r);continue}}else if(i(r)){n.appendChild(e.createDefaultBlock([ge(e,r,e._doc.createDocumentFragment())]));continue}ge(e,r,n)}return n}function me(e){var t=function(t,n){return this.modifyBlocks(e,t),("undefined"==typeof n||n)&&this.focus(),this};return t.modifier=e,t}var Ne=2,Ce=1,_e=3,ye=9,Se=11,Te=1,be=4,Ee=0,ke=1,Le=2,xe=3,Ae="highlight",Be="colour",Oe="font",De="size",Re="​",Ue=document.defaultView,Pe=navigator.userAgent,Ie=/Android/.test(Pe),we=/iP(?:ad|hone|od)/.test(Pe),Fe=/Mac OS X/.test(Pe),Me=/Windows NT/.test(Pe),He=/Gecko\//.test(Pe),We=/Trident\/[456]\./.test(Pe),ze=!!Ue.opera,qe=/Edge\//.test(Pe),Ke=!qe&&/WebKit\//.test(Pe),Ge=/Trident\/[4567]\./.test(Pe),Ze=Fe?"meta-":"ctrl-",je=We||ze,Qe=We||Ke,Ve=We,$e="undefined"!=typeof MutationObserver,Ye="undefined"!=typeof WeakMap,Xe=/[^ \t\r\n]/,Je=Array.prototype.indexOf;Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t});var et={1:1,2:2,3:4,8:128,9:256,11:1024},tt=function(e,t,n){this.root=this.currentNode=e,this.nodeType=t,this.filter=n};tt.prototype.nextNode=function(){for(var e=this,t=this,n=t.currentNode,r=this,o=r.root,i=r.nodeType,a=r.filter;;){for(var s=n.firstChild;!s&&n&&n!==o;)s=n.nextSibling,s||(n=n.parentNode);if(!s)return null;if(et[s.nodeType]&i&&a(s))return e.currentNode=s,s;n=s}},tt.prototype.previousNode=function(){for(var e=this,t=this,n=t.currentNode,r=this,o=r.root,i=r.nodeType,a=r.filter;;){if(n===o)return null;var s=n.previousSibling;if(s)for(;n=s.lastChild;)s=n;else s=n.parentNode;if(!s)return null;if(et[s.nodeType]&i&&a(s))return e.currentNode=s,s;n=s}},tt.prototype.previousPONode=function(){for(var e=this,t=this,n=t.currentNode,r=this,o=r.root,i=r.nodeType,a=r.filter;;){for(var s=n.lastChild;!s&&n&&n!==o;)s=n.previousSibling,s||(n=n.parentNode);if(!s)return null;if(et[s.nodeType]&i&&a(s))return e.currentNode=s,s;n=s}};var nt,rt=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,ot={BR:1,HR:1,IFRAME:1,IMG:1,INPUT:1},it=0,at=1,st=2,dt=3;t();var lt=new tt(null,be|Te,function(e){return e.nodeType===_e?Xe.test(e.data):"IMG"===e.nodeName}),ct={1:10,2:13,3:16,4:18,5:24,6:32,7:48},ut={backgroundColor:{regexp:Xe,replace:function(e,t){return C(e,"SPAN",{class:Ae,style:"background-color:"+t})}},color:{regexp:Xe,replace:function(e,t){return C(e,"SPAN",{class:Be,style:"color:"+t})}},fontWeight:{regexp:/^bold|^700/i,replace:function(e){return C(e,"B")}},fontStyle:{regexp:/^italic/i,replace:function(e){return C(e,"I")}},fontFamily:{regexp:Xe,replace:function(e,t){return C(e,"SPAN",{class:Oe,style:"font-family:"+t})}},fontSize:{regexp:Xe,replace:function(e,t){return C(e,"SPAN",{class:De,style:"font-size:"+t})}},textDecoration:{regexp:/^underline/i,replace:function(e){return C(e,"U")}}},ft={P:z,SPAN:z,STRONG:W("B"),EM:W("I"),INS:W("U"),STRIKE:W("S"),FONT:function(e,t){var n,r,o=e.face,i=e.size,a=e.color,s=e.ownerDocument;if(o){var d=C(s,"SPAN",{class:Oe,style:"font-family:"+o});r=d,n=d}if(i){var l=C(s,"SPAN",{class:De,style:"font-size:"+ct[i]+"px"});r||(r=l),n&&n.appendChild(l),n=l}if(a&&/^#?([\dA-F]{3}){1,2}$/i.test(a)){"#"!==a.charAt(0)&&(a="#"+a);var c=C(s,"SPAN",{class:Be,style:"color:"+a});r||(r=c),n&&n.appendChild(c),n=c}return r||(r=n=C(s,"SPAN")),t.replaceChild(r,e),n.appendChild(N(e)),n},TT:function(e,t){var n=C(e.ownerDocument,"SPAN",{class:Oe,style:'font-family:menlo,consolas,"courier new",monospace'});return t.replaceChild(n,e),n.appendChild(N(e)),n}},ht=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,pt=/^(?:HEAD|META|STYLE)/,vt=new tt(null,be|Te,function(){return!0}),gt={8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",37:"left",39:"right",46:"delete",219:"[",221:"]"},mt={enter:function(e,t,n){t.preventDefault(),e._recordUndoState(n);var r=e._root;pe(n.startContainer,r,e),e._removeZWS(),e._getRangeAndRemoveBookmark(n),n.collapsed||O(n,r);var o=I(n,r);if(!o||/^T[HD]$/.test(o.nodeName)){var i=f(n.endContainer,r,"A");return i&&(i=i.parentNode,P(n,i,i,r),n.collapse(!1)),A(n,e.createElement("BR")),n.collapse(!1),e.setSelection(n),void e._updatePath(n,!0)}var a=f(o,r,"LI");if(a&&(o=a),!o.textContent){if(f(o,r,"UL")||f(o,r,"OL"))return e.decreaseListLevel(n,!1);if(f(o,r,"BLOCKQUOTE"))return e.modifyBlocks(fe,n)}var s=ue(e,o,n.startContainer,n.startOffset);for(ce(o),K(o),_(o,r);s.nodeType===Ce;){var d=s.firstChild;if("A"===s.nodeName&&(!s.textContent||s.textContent===Re)){d=e._doc.createTextNode(""),m(s,d),s=d;break}for(;d&&d.nodeType===_e&&!d.data;){var l=d.nextSibling;if(!l||"BR"===l.nodeName)break;g(d),d=l}if(!d||"BR"===d.nodeName||d.nodeType===_e&&!ze)break;s=d}n=e._createRange(s,0),e.setSelection(n),e._updatePath(n,!0)},backspace:function(e,t,n){var r=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(F(n,r)){t.preventDefault();var o=I(n,r);if(!o)return;y(o.parentNode,r);var i=d(o,r);if(i){if(!i.isContentEditable)return void g(i);for(E(i,o,n),o=i.parentNode;o!==r&&!o.nextSibling;)o=o.parentNode;o!==r&&(o=o.nextSibling)&&k(o,r),e.setSelection(n)}else if(o){if(f(o,r,"UL")||f(o,r,"OL"))return e.decreaseListLevel(n,!1);if(f(o,r,"BLOCKQUOTE"))return e.decreaseBlockQuoteLevel(n,!1);e.setSelection(n),e._updatePath(n,!0)}}else e.setSelection(n),setTimeout(function(){return re(e)},0);else t.preventDefault(),O(n,r),re(e,n)},delete:function(e,t,n){var r=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(M(n,r)){t.preventDefault();var o=I(n,r);if(!o)return;y(o.parentNode,r);var i=l(o,r);if(i){if(!i.isContentEditable)return void g(i);for(E(o,i,n),i=o.parentNode;i!==r&&!i.nextSibling;)i=i.parentNode;i!==r&&(i=i.nextSibling)&&k(i,r),e.setSelection(n),e._updatePath(n,!0)}}else{var a=n.cloneRange();P(n,r,r,r);var s=n.endContainer,d=n.endOffset;if(s.nodeType===Ce){var c=s.childNodes[d];if(c&&"IMG"===c.nodeName)return t.preventDefault(),g(c),U(n),void re(e,n)}e.setSelection(a),setTimeout(function(){return re(e)},0)}else t.preventDefault(),O(n,r),re(e,n)},tab:function(e,t,n){var r=e._root;if(e._removeZWS(),n.collapsed&&F(n,r))for(var o,i=I(n,r);o=i.parentNode;){if("UL"===o.nodeName||"OL"===o.nodeName){t.preventDefault(),e.increaseListLevel(n,!1);break}i=o}},"shift-tab":function(e,t,n){var r=e._root;if(e._removeZWS(),n.collapsed&&F(n,r)){var o=n.startContainer;(f(o,r,"UL")||f(o,r,"OL"))&&(t.preventDefault(),e.decreaseListLevel(n,!1))}},space:function(e,t,n){e._recordUndoState(n),pe(n.startContainer,e._root,e),e._getRangeAndRemoveBookmark(n);var r=n.endContainer,o=r.parentNode;n.collapsed&&"A"===o.nodeName&&!r.nextSibling&&n.endOffset===v(r)?n.setStartAfter(o):n.collapsed||(O(n,e._root),e._ensureBottomLine(),e.setSelection(n),e._updatePath(n,!0)),e.setSelection(n)},left:function(e){e._removeZWS()},right:function(e){e._removeZWS()}};Fe&&He&&(mt["meta-left"]=function(e,t){t.preventDefault();var n=ae(e);n&&n.modify&&n.modify("move","backward","lineboundary")},mt["meta-right"]=function(e,t){t.preventDefault();var n=ae(e);n&&n.modify&&n.modify("move","forward","lineboundary")}),Fe||(mt.pageup=function(e){return e.moveCursorToStart()},mt.pagedown=function(e){return e.moveCursorToEnd()}),mt[Ze+"b"]=ne("B"),mt[Ze+"i"]=ne("I"),mt[Ze+"u"]=ne("U"),mt[Ze+"shift-7"]=ne("S"),mt[Ze+"shift-5"]=ne("SUB",{tag:"SUP"}),mt[Ze+"shift-6"]=ne("SUP",{tag:"SUB"}),mt[Ze+"shift-8"]=te("makeUnorderedList"),mt[Ze+"shift-9"]=te("makeOrderedList"),mt[Ze+"["]=te("decreaseQuoteLevel"),mt[Ze+"]"]=te("increaseQuoteLevel"),mt[Ze+"y"]=te("redo"),mt[Ze+"z"]=te("undo"),mt[Ze+"shift-z"]=te("redo");var Nt={pathChange:1,select:1,input:1,undoStateChange:1},Ct={DT:"DD",DD:"DT",LI:"LI"},_t="squire-selection-start",yt="squire-selection-end",St=/\b((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,}\b)/i,Tt=function(e,t){e.nodeType===ye&&(e=e.body);var n=e.ownerDocument,r=n.defaultView;if(this._win=r,this._doc=n,this._root=e,this._events={},this._isFocused=!1,this._lastSelection=null,Ve&&this.addEventListener("beforedeactivate",this.getSelection),this._hasZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._willUpdatePath=!1,"onselectionchange"in n?this.addEventListener("selectionchange",this._updatePathOnEvent):(this.addEventListener("keyup",this._updatePathOnEvent),this.addEventListener("mouseup",this._updatePathOnEvent)),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,$e){var o=new MutationObserver(this._docWasChanged.bind(this));o.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=o}else this.addEventListener("keyup",this._keyUpDetectChange);this._restoreSelection=!1,this.addEventListener("blur",se),this.addEventListener("mousedown",de),this.addEventListener("touchstart",de),this.addEventListener("focus",le),this._awaitingPaste=!1,this.addEventListener(We?"beforecut":"cut",V),this.addEventListener("copy",$),this.addEventListener("keydown",Y),this.addEventListener("keyup",Y),this.addEventListener(We?"beforepaste":"paste",X),this.addEventListener("drop",J),this.addEventListener(ze?"keypress":"keydown",ee),this._keyHandlers=Object.create(mt),this.setConfig(t),We&&(r.Text.prototype.splitText=function(e){var t=this.ownerDocument.createTextNode(this.data.slice(e)),n=this,r=n.nextSibling,o=n.parentNode,i=this.length-e;return r?o.insertBefore(t,r):o.appendChild(t),i&&this.deleteData(e,i),t}),e.setAttribute("contenteditable","true");try{n.execCommand("enableObjectResizing",!1,"false"),n.execCommand("enableInlineTableEditing",!1,"false")}catch(e){}e.__squire__=this,this.setHTML("")};return Tt.prototype.setConfig=function(e){return e=oe({blockTag:"DIV",blockAttributes:null,tagAttributes:{blockquote:null,ul:null,ol:null,li:null,a:null},leafNodeNames:ot,undo:{documentSizeThreshold:-1,undoLimit:-1},isInsertedHTMLSanitized:!0,isSetHTMLSanitized:!0,sanitizeToDOMFragment:"undefined"!=typeof DOMPurify&&DOMPurify.isSupported?ie:null},e,!0),e.blockTag=e.blockTag.toUpperCase(),this._config=e,this},Tt.prototype.createElement=function(e,t,n){return C(this._doc,e,t,n)},Tt.prototype.createDefaultBlock=function(e){var t=this._config;return _(this.createElement(t.blockTag,t.blockAttributes,e),this._root)},Tt.prototype.didError=function(e){console.log(e)},Tt.prototype.getDocument=function(){return this._doc},Tt.prototype.getRoot=function(){return this._root},Tt.prototype.modifyDocument=function(e){var t=this._mutation;t&&(t.takeRecords().length&&this._docWasChanged(),t.disconnect()),this._ignoreAllChanges=!0,e(),this._ignoreAllChanges=!1,t&&(t.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1)},Tt.prototype.fireEvent=function(e,t){var n=this,r=this._events[e];if(/^(?:focus|blur)/.test(e)){var o=h(this._root,this._doc.activeElement);if("focus"===e){if(!o||this._isFocused)return this;this._isFocused=!0}else{if(o||!this._isFocused)return this;this._isFocused=!1}}if(r){t||(t={}),t.type!==e&&(t.type=e),r=r.slice();for(var i=r.length;i--;){var a=r[i];try{a.handleEvent?a.handleEvent(t):a.call(n,t)}catch(t){t.details="Squire: fireEvent error. Event type: "+e,n.didError(t)}}}return this},Tt.prototype.destroy=function(){var e=this;for(var t in e._events)e.removeEventListener(t);this._mutation&&this._mutation.disconnect(),delete this._root.__squire__,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0},Tt.prototype.handleEvent=function(e){this.fireEvent(e.type,e)},Tt.prototype.addEventListener=function(e,t){if(!t)return this.didError({name:"Squire: addEventListener with null or undefined fn",message:"Event type: "+e}),this;var n=this._events[e];if(!n&&(n=this._events[e]=[],!Nt[e])){var r=this._root;"selectionchange"===e&&(r=this._doc),r.addEventListener(e,this,!0)}return n.push(t),this},Tt.prototype.removeEventListener=function(e,t){var n=this._events[e];if(n){if(t)for(var r=n.length;r--;)n[r]===t&&n.splice(r,1);else n.length=0;if(!n.length&&(delete this._events[e],!Nt[e])){var o=this._root;"selectionchange"===e&&(o=this._doc),o.removeEventListener(e,this,!0)}}return this},Tt.prototype._createRange=function(e,t,n,r){if(e instanceof this._win.Range)return e.cloneRange();var o=this._doc.createRange();return o.setStart(e,t),n?o.setEnd(n,r):o.setEnd(e,t),o},Tt.prototype.getCursorPosition=function(e){if(!e&&!(e=this.getSelection())||!e.getBoundingClientRect)return null;var t=e.getBoundingClientRect();if(t&&!t.top){this._ignoreChange=!0;var n=this._doc.createElement("SPAN");n.textContent=Re,A(e,n),t=n.getBoundingClientRect();var r=n.parentNode;r.removeChild(n),b(r,e)}return t},Tt.prototype._moveCursorTo=function(e){var t=this._root,n=this._createRange(t,e?0:t.childNodes.length);return U(n),this.setSelection(n),this},Tt.prototype.moveCursorToStart=function(){return this._moveCursorTo(!0)},Tt.prototype.moveCursorToEnd=function(){return this._moveCursorTo(!1)},Tt.prototype.setSelection=function(e){if(e)if(this._lastSelection=e,this._isFocused)if(Ie&&!this._restoreSelection)se.call(this),this.blur(),this.focus();else{we&&this._win.focus();var t=ae(this);t&&(t.removeAllRanges(),t.addRange(e))}else se.call(this);return this},Tt.prototype.getSelection=function(){var e,t=ae(this);if(this._isFocused&&t&&t.rangeCount){e=t.getRangeAt(0).cloneRange();var r=e.startContainer,o=e.endContainer;r&&n(r)&&e.setStartBefore(r),o&&n(o)&&e.setEndBefore(o)}var i=this._root;return e&&h(i,e.commonAncestorContainer)?this._lastSelection=e:e=this._lastSelection,e||(e=this._createRange(i.firstChild,0)),e},Tt.prototype.getSelectedText=function(){
var e=this.getSelection(),t=new tt(e.commonAncestorContainer,be|Te,function(t){return R(e,t,!0)}),n=e.startContainer,r=e.endContainer,i=t.currentNode=n,a="",s=!1;for(t.filter(i)||(i=t.nextNode());i;){if(i.nodeType===_e){var d=i.data;d&&/\S/.test(d)&&(i===r&&(d=d.slice(0,e.endOffset)),i===n&&(d=d.slice(e.startOffset)),a+=d,s=!0)}else("BR"===i.nodeName||s&&!o(i))&&(a+="\n",s=!1);i=t.nextNode()}return a},Tt.prototype.getPath=function(){return this._path},Tt.prototype._didAddZWS=function(){this._hasZWS=!0},Tt.prototype._removeZWS=function(){this._hasZWS&&(ce(this._root),this._hasZWS=!1)},Tt.prototype._updatePath=function(e,t){var n=e.startContainer,r=e.endContainer;if(t||n!==this._lastAnchorNode||r!==this._lastFocusNode){this._lastAnchorNode=n,this._lastFocusNode=r;var o=n&&r?n===r?p(r,this._root):"(selection)":"";this._path!==o&&(this._path=o,this.fireEvent("pathChange",{path:o}))}e.collapsed||this.fireEvent("select")},Tt.prototype._updatePathOnEvent=function(){var e=this;this._willUpdatePath||(this._willUpdatePath=!0,setTimeout(function(){e._willUpdatePath=!1,e._updatePath(e.getSelection())},0))},Tt.prototype.focus=function(){return this._root.focus(),Ge&&this.fireEvent("focus"),this},Tt.prototype.blur=function(){return this._root.blur(),Ge&&this.fireEvent("blur"),this},Tt.prototype._saveRangeToBookmark=function(e){var t=this.createElement("INPUT",{id:_t,type:"hidden"}),n=this.createElement("INPUT",{id:yt,type:"hidden"});if(A(e,t),e.collapse(!1),A(e,n),t.compareDocumentPosition(n)&Ne){t.id=yt,n.id=_t;var r=t;t=n,n=r}e.setStartAfter(t),e.setEndBefore(n)},Tt.prototype._getRangeAndRemoveBookmark=function(e){var t=this._root,n=t.querySelector("#"+_t),r=t.querySelector("#"+yt);if(n&&r){var o=n.parentNode,i=r.parentNode,a=Je.call(o.childNodes,n),s=Je.call(i.childNodes,r);o===i&&(s-=1),g(n),g(r),e||(e=this._doc.createRange()),e.setStart(o,a),e.setEnd(i,s),b(o,e),o!==i&&b(i,e),e.collapsed&&(o=e.startContainer,o.nodeType===_e&&(i=o.childNodes[e.startOffset],i&&i.nodeType===_e||(i=o.childNodes[e.startOffset-1]),i&&i.nodeType===_e&&(e.setStart(i,0),e.collapse(!0))))}return e||null},Tt.prototype._keyUpDetectChange=function(e){var t=e.keyCode;e.ctrlKey||e.metaKey||e.altKey||!(t<16||t>20)||!(t<33||t>45)||this._docWasChanged()},Tt.prototype._docWasChanged=function(){if(t(),!this._ignoreAllChanges){if($e&&this._ignoreChange)return void(this._ignoreChange=!1);this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")}},Tt.prototype._recordUndoState=function(e){if(!this._isInUndoState){var t=this._undoIndex+=1,n=this._undoStack;t<this._undoStackLength&&(n.length=this._undoStackLength=t),e&&this._saveRangeToBookmark(e);var r=this._getHTML(),o=this._config.undo,i=o.documentSizeThreshold,a=o.undoLimit;i>-1&&2*r.length>i&&a>-1&&t>a&&(n.splice(0,t-a),t=this._undoIndex=a,this._undoStackLength=a),n[t]=r,this._undoStackLength+=1,this._isInUndoState=!0}},Tt.prototype.saveUndoState=function(e){return void 0===e&&(e=this.getSelection()),this._isInUndoState||(this._recordUndoState(e),this._getRangeAndRemoveBookmark(e)),this},Tt.prototype.undo=function(){if(0!==this._undoIndex||!this._isInUndoState){this._recordUndoState(this.getSelection()),this._undoIndex-=1,this._setHTML(this._undoStack[this._undoIndex]);var e=this._getRangeAndRemoveBookmark();e&&this.setSelection(e),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")}return this},Tt.prototype.redo=function(){var e=this._undoIndex,t=this._undoStackLength;if(e+1<t&&this._isInUndoState){this._undoIndex+=1,this._setHTML(this._undoStack[this._undoIndex]);var n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:e+2<t}),this.fireEvent("input")}return this},Tt.prototype.hasFormat=function(e,t,n){if(e=e.toUpperCase(),t||(t={}),!n&&!(n=this.getSelection()))return!1;!n.collapsed&&n.startContainer.nodeType===_e&&n.startOffset===n.startContainer.length&&n.startContainer.nextSibling&&n.setStartBefore(n.startContainer.nextSibling),!n.collapsed&&n.endContainer.nodeType===_e&&0===n.endOffset&&n.endContainer.previousSibling&&n.setEndAfter(n.endContainer.previousSibling);var r=this._root,o=n.commonAncestorContainer;if(f(o,r,e,t))return!0;if(o.nodeType===_e)return!1;for(var i,a=new tt(o,be,function(e){return R(n,e,!0)},!1),s=!1;i=a.nextNode();){if(!f(i,r,e,t))return!1;s=!0}return s},Tt.prototype.getFontInfo=function(e){var t={color:void 0,backgroundColor:void 0,family:void 0,size:void 0};if(!e&&!(e=this.getSelection()))return t;var n=e.commonAncestorContainer;if(e.collapsed||n.nodeType===_e){n.nodeType===_e&&(n=n.parentNode);for(var r=0;r<4&&n;){var o=n.style;if(o){var i=void 0;!t.color&&(i=o.color)&&(t.color=i,r+=1),!t.backgroundColor&&(i=o.backgroundColor)&&(t.backgroundColor=i,r+=1),!t.family&&(i=o.fontFamily)&&(t.family=i,r+=1),!t.size&&(i=o.fontSize)&&(t.size=i,r+=1)}n=n.parentNode}}return t},Tt.prototype._addFormat=function(e,t,n){var r=this,i=this._root;if(n.collapsed){var a=_(this.createElement(e,t),i);A(n,a),n.setStart(a.firstChild,a.firstChild.length),n.collapse(!0);for(var s=a;o(s);)s=s.parentNode;ce(s,a)}else{var d=new tt(n.commonAncestorContainer,be|Te,function(e){return(e.nodeType===_e||"BR"===e.nodeName||"IMG"===e.nodeName)&&R(n,e,!0)},!1),l=n.startContainer,c=n.startOffset,u=n.endContainer,h=n.endOffset;if(d.currentNode=l,d.filter(l)||(l=d.nextNode(),c=0),!l)return n;var p;do if(p=d.currentNode,!f(p,i,e,t)){p===u&&p.length>h&&p.splitText(h),p===l&&c&&(p=p.splitText(c),u===l&&(u=p,h-=c),l=p,c=0);var v=r.createElement(e,t);m(p,v),v.appendChild(p)}while(d.nextNode());u.nodeType!==_e&&(p.nodeType===_e?(u=p,h=p.length):(u=p.parentNode,h=1)),n=this._createRange(l,c,u,h)}return n},Tt.prototype._removeFormat=function(e,t,n,r){function i(e,t){if(!R(n,e,!1)){var r=e.nodeType===_e;if(!R(n,e,!0))return void("INPUT"===e.nodeName||r&&!e.data||p.push([t,e]));if(r)e===f&&h!==e.length&&p.push([t,e.splitText(h)]),e===l&&c&&(e.splitText(c),p.push([t,e]));else for(var o=e.firstChild;o;){var a=o.nextSibling;i(o,t),o=a}}}this._saveRangeToBookmark(n);var a,s=this._doc;n.collapsed&&(Qe?(a=s.createTextNode(Re),this._didAddZWS()):a=s.createTextNode(""),A(n,a));for(var d=n.commonAncestorContainer;o(d);)d=d.parentNode;var l=n.startContainer,c=n.startOffset,f=n.endContainer,h=n.endOffset,p=[],v=Array.prototype.filter.call(d.getElementsByTagName(e),function(r){return R(n,r,!0)&&u(r,e,t)});return r||v.forEach(function(e){return i(e,e)}),p.forEach(function(e){var t=e[0],n=e[1],r=t.cloneNode(!1);m(n,r),r.appendChild(n)}),v.forEach(function(e){return m(e,N(e))}),this._getRangeAndRemoveBookmark(n),a&&n.collapse(!1),b(d,n),n},Tt.prototype.changeFormat=function(e,t,n,r){return n||(n=this.getSelection())?(this.saveUndoState(n),t&&(n=this._removeFormat(t.tag.toUpperCase(),t.attributes||{},n,r)),e&&(n=this._addFormat(e.tag.toUpperCase(),e.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),$e||this._docWasChanged(),this):this},Tt.prototype.forEachBlock=function(e,t,n){if(!n&&!(n=this.getSelection()))return this;t&&this.saveUndoState(n);var r=this._root,o=I(n,r),i=w(n,r);if(o&&i)do if(e(o)||o===i)break;while(o=l(o,r));return t&&(this.setSelection(n),this._updatePath(n,!0),$e||this._docWasChanged()),this},Tt.prototype.modifyBlocks=function(e,t){if(!t&&!(t=this.getSelection()))return this;this._isInUndoState?this._saveRangeToBookmark(t):this._recordUndoState(t);var n=this._root;H(t,n),P(t,n,n,n);var r=B(t,n,n);return A(t,e.call(this,r)),t.endOffset<t.endContainer.childNodes.length&&k(t.endContainer.childNodes[t.endOffset],n),k(t.startContainer.childNodes[t.startOffset],n),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),$e||this._docWasChanged(),this},Tt.prototype._ensureBottomLine=function(){var e=this._root,t=e.lastElementChild;t&&t.nodeName===this._config.blockTag&&i(t)||e.appendChild(this.createDefaultBlock())},Tt.prototype.setKeyHandler=function(e,t){return this._keyHandlers[e]=t,this},Tt.prototype._getHTML=function(){return this._root.innerHTML},Tt.prototype._setHTML=function(e){var t=this._root,n=t;n.innerHTML=e;do _(n,t);while(n=l(n,t));this._ignoreChange=!0},Tt.prototype.getHTML=function(e){var t,n=this,r=[];if(e&&(t=this.getSelection())&&this._saveRangeToBookmark(t),je)for(var o=this._root,i=o;i=l(i,o);)if(!i.textContent&&!i.querySelector("BR")){var a=n.createElement("BR");i.appendChild(a),r.push(a)}var s=this._getHTML().replace(/\u200B/g,"");if(je)for(var d=r.length;d--;)g(r[d]);return t&&this._getRangeAndRemoveBookmark(t),s},Tt.prototype.setHTML=function(e){var t,n=this._config,r=n.isSetHTMLSanitized?n.sanitizeToDOMFragment:null,o=this._root;if("function"==typeof r)t=r(e,!1,this);else{var i=this.createElement("DIV");i.innerHTML=e,t=this._doc.createDocumentFragment(),t.appendChild(N(i))}q(t),j(t,o,!1),y(t,o);for(var a=t;a=l(a,o);)_(a,o);this._ignoreChange=!0;for(var s;s=o.lastChild;)o.removeChild(s);o.appendChild(t),_(o,o),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;var d=this._getRangeAndRemoveBookmark()||this._createRange(o.firstChild,0);return this.saveUndoState(d),this._lastSelection=d,se.call(this),this._updatePath(d,!0),this},Tt.prototype.insertElement=function(e,t){if(t||(t=this.getSelection()),t.collapse(!0),o(e))A(t,e),t.setStartAfter(e);else{for(var n=this._root,r=I(t,n)||n;r!==n&&!r.nextSibling;)r=r.parentNode;var i;r!==n&&(i=S(r.parentNode,r.nextSibling,n,n)),i?n.insertBefore(e,i):(n.appendChild(e),i=this.createDefaultBlock(),n.appendChild(i)),t.setStart(i,0),t.setEnd(i,0),U(t)}return this.focus(),this.setSelection(t),this._updatePath(t),$e||this._docWasChanged(),this},Tt.prototype.insertImage=function(e,t){var n=this.createElement("IMG",oe({src:e},t,!0));return this.insertElement(n),n},Tt.prototype.insertHTML=function(e,t){var n,r=this._config,o=r.isInsertedHTMLSanitized?r.sanitizeToDOMFragment:null,i=this.getSelection(),a=this._doc;if("function"==typeof o)n=o(e,t,this);else{if(t){var s=e.indexOf("<!--StartFragment-->"),d=e.lastIndexOf("<!--EndFragment-->");s>-1&&d>-1&&(e=e.slice(s+20,d))}var c=this.createElement("DIV");c.innerHTML=e,n=a.createDocumentFragment(),n.appendChild(N(c))}this.saveUndoState(i);try{var u=this._root,f=n,h={fragment:n,preventDefault:function(){this.defaultPrevented=!0},defaultPrevented:!1};for(pe(n,n,this),q(n),j(n,u,!1),K(n),n.normalize();f=l(f,n);)_(f,u);t&&this.fireEvent("willPaste",h),h.defaultPrevented||(D(i,h.fragment,u),$e||this._docWasChanged(),i.collapse(!1),this._ensureBottomLine()),this.setSelection(i),this._updatePath(i,!0),t&&this.focus()}catch(e){this.didError(e)}return this},Tt.prototype.insertPlainText=function(e,t){var n=e.split("\n"),r=this._config,o=r.blockTag,i=r.blockAttributes,a="</"+o+">",s="<"+o;for(var d in i)s+=" "+d+'="'+ve(i[d])+'"';s+=">";for(var l=0,c=n.length;l<c;l+=1){var u=n[l];u=ve(u).replace(/ (?= )/g,"&nbsp;"),l&&l+1<c&&(u=s+(u||"<BR>")+a),n[l]=u}return this.insertHTML(n.join(""),t)},Tt.prototype.addStyles=function(e){if(e){var t=this._doc.documentElement.firstChild,n=this.createElement("STYLE",{type:"text/css"});n.appendChild(this._doc.createTextNode(e)),t.appendChild(n)}return this},Tt.prototype.bold=function(){return this.changeFormat({tag:"B"}).focus()},Tt.prototype.italic=function(){return this.changeFormat({tag:"I"}).focus()},Tt.prototype.underline=function(){return this.changeFormat({tag:"U"}).focus()},Tt.prototype.strikethrough=function(){return this.changeFormat({tag:"S"}).focus()},Tt.prototype.subscript=function(){return this.changeFormat({tag:"SUB"},{tag:"SUP"}).focus()},Tt.prototype.superscript=function(){return this.changeFormat({tag:"SUP"},{tag:"SUB"}).focus()},Tt.prototype.removeBold=function(){return this.changeFormat(null,{tag:"B"}).focus()},Tt.prototype.removeItalic=function(){return this.changeFormat(null,{tag:"I"}).focus()},Tt.prototype.removeUnderline=function(){return this.changeFormat(null,{tag:"U"}).focus()},Tt.prototype.removeStrikethrough=function(){return this.changeFormat(null,{tag:"S"}).focus()},Tt.prototype.removeSubscript=function(){return this.changeFormat(null,{tag:"SUB"}).focus()},Tt.prototype.removeSuperscript=function(){return this.changeFormat(null,{tag:"SUP"}).focus()},Tt.prototype.makeLink=function(e,t){var n=this.getSelection();if(n.collapsed){var r=e.indexOf(":")+1;if(r)for(;"/"===e[r];)r+=1;A(n,this._doc.createTextNode(e.slice(r)))}return t=oe(oe({href:e},t,!0),this._config.tagAttributes.a,!1),this.changeFormat({tag:"A",attributes:t},{tag:"A"},n),this.focus()},Tt.prototype.removeLink=function(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0),this.focus()},Tt.prototype.setFontFace=function(e){return this.changeFormat(e?{tag:"SPAN",attributes:{class:Oe,style:"font-family: "+e+", sans-serif;"}}:null,{tag:"SPAN",attributes:{class:Oe}}),this.focus()},Tt.prototype.setFontSize=function(e){return this.changeFormat(e?{tag:"SPAN",attributes:{class:De,style:"font-size: "+("number"==typeof e?e+"px":e)}}:null,{tag:"SPAN",attributes:{class:De}}),this.focus()},Tt.prototype.setTextColour=function(e){return this.changeFormat(e?{tag:"SPAN",attributes:{class:Be,style:"color:"+e}}:null,{tag:"SPAN",attributes:{class:Be}}),this.focus()},Tt.prototype.setHighlightColour=function(e){return this.changeFormat(e?{tag:"SPAN",attributes:{class:Ae,style:"background-color:"+e}}:e,{tag:"SPAN",attributes:{class:Ae}}),this.focus()},Tt.prototype.setTextAlignment=function(e){return this.forEachBlock(function(t){var n=t.className.split(/\s+/).filter(function(e){return!!e&&!/^align/.test(e)}).join(" ");e?(t.className=n+" align-"+e,t.style.textAlign=e):(t.className=n,t.style.textAlign="")},!0),this.focus()},Tt.prototype.setTextDirection=function(e){return this.forEachBlock(function(t){e?t.dir=e:t.removeAttribute("dir")},!0),this.focus()},Tt.prototype.removeAllFormatting=function(e){if(!e&&!(e=this.getSelection())||e.collapsed)return this;for(var t=this._root,n=e.commonAncestorContainer;n&&!i(n);)n=n.parentNode;if(n||(H(e,t),n=t),n.nodeType===_e)return this;this.saveUndoState(e),P(e,n,n,t);for(var r=n.ownerDocument,o=e.startContainer,a=e.startOffset,s=e.endContainer,d=e.endOffset,l=r.createDocumentFragment(),c=r.createDocumentFragment(),u=S(s,d,n,t),f=S(o,a,n,t);f!==u;){var h=f.nextSibling;l.appendChild(f),f=h}ge(this,l,c),c.normalize(),f=c.firstChild;var p=c.lastChild,v=n.childNodes;return f?(n.insertBefore(c,u),a=Je.call(v,f),d=Je.call(v,p)+1):(a=Je.call(v,u),d=a),e.setStart(n,a),e.setEnd(n,d),b(n,e),U(e),this.setSelection(e),this._updatePath(e,!0),this.focus()},Object.assign(Tt.prototype,{increaseBlockQuoteLevel:me(function(e){return this.createElement("BLOCKQUOTE",this._config.tagAttributes.blockquote,[e])}),decreaseBlockQuoteLevel:me(function(e){var t=this._root,n=e.querySelectorAll("blockquote");return Array.prototype.filter.call(n,function(e){return!f(e.parentNode,t,"BLOCKQUOTE")}).forEach(function(e){return m(e,N(e))}),e}),makeUnorderedList:me(function(e){return he(this,e,"UL"),e}),makeOrderedList:me(function(e){return he(this,e,"OL"),e}),removeList:me(function(e){for(var t=this,n=e.querySelectorAll("UL, OL"),r=e.querySelectorAll("LI"),o=this._root,a=0,s=n.length;a<s;a+=1){var d=n[a],l=N(d);y(l,o),m(d,l)}for(var c=0,u=r.length;c<u;c+=1){var f=r[c];i(f)?m(f,t.createDefaultBlock([N(f)])):(y(f,o),m(f,N(f)))}return e}),increaseListLevel:me(function(e){for(var t=this,n=e.querySelectorAll("LI"),r=this._config.tagAttributes,o=0,i=n.length;o<i;o+=1){var s=n[o];if(!a(s.firstChild)){var d=s.parentNode.nodeName,l=s.previousSibling;if(!l||!(l=l.lastChild)||l.nodeName!==d){var c=r[d.toLowerCase()];l=t.createElement(d,c),m(s,l)}l.appendChild(s)}}return e}),decreaseListLevel:me(function(e){var t=this._root,n=e.querySelectorAll("LI");return Array.prototype.filter.call(n,function(e){return!a(e.firstChild)}).forEach(function(n){var r=n.parentNode,o=r.parentNode,i=n.firstChild;if(n.previousSibling&&(r=S(r,n,o,t)),/^[OU]L$/.test(o.nodeName))o.insertBefore(n,r),r.firstChild||o.removeChild(r);else for(var s=i;s;){var d=s.nextSibling;if(a(s))break;o.insertBefore(s,r),s=d}for("LI"===o.nodeName&&i.previousSibling&&S(o,i,o.parentNode,t);n!==e&&!n.childNodes.length;)r=n.parentNode,r.removeChild(n),n=r}),y(e,t),e})}),Object.assign(Tt,{isInline:o,isBlock:i,isContainer:a,getBlockWalker:s,getPreviousBlock:d,getNextBlock:l,areAlike:c,hasTagAttributes:u,getNearest:f,isOrContains:h,detach:g,replaceWith:m,empty:N,getNodeBefore:L,getNodeAfter:x,insertNodeInRange:A,extractContentsOfRange:B,deleteContentsOfRange:O,insertTreeFragmentIntoRange:D,isNodeContainedInRange:R,moveRangeBoundariesDownTree:U,moveRangeBoundariesUpTree:P,getStartBlockOfRange:I,getEndBlockOfRange:w,contentWalker:lt,rangeDoesStartAtBlockBoundary:F,rangeDoesEndAtBlockBoundary:M,expandRangeToBlockBoundaries:H,onPaste:X,addLinks:pe,splitBlock:ue,startSelectionId:_t,endSelectionId:yt}),"object"==typeof exports||"function"==typeof define&&define.amd||top!==window&&"true"===document.documentElement.getAttribute("data-squireinit")&&(window.editor=new Tt(document),window.onEditorLoad&&(window.onEditorLoad(window.editor),window.onEditorLoad=null)),Tt}();